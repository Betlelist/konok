<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>KONOK 13.0 Clean</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div class="app-container">

        <div id="screen-login" class="screen active center-content">
            <div class="login-box">
                <div class="logo-circle">K</div>
                <h1>KONOK</h1>
                <p class="text-muted">Travel CRM</p>
                <div class="ios-form">
                    <input type="text" id="login-phone" placeholder="–õ–æ–≥–∏–Ω">
                    <input type="password" id="login-pass" placeholder="–ü–∞—Ä–æ–ª—å">
                </div>
                <div class="login-hints"><small>admin: 123 | agent: 000</small></div>
                <button class="btn btn-primary" id="btn-login-action">–í–æ–π—Ç–∏</button>
            </div>
        </div>

        <div id="screen-tours" class="screen">
            <div class="ios-header">
                <div>
                    <h2 class="header-title">–†–µ–π—Å—ã</h2>
                    <span class="header-subtitle" id="header-date">–°–µ–≥–æ–¥–Ω—è</span>
                </div>
                <div class="header-icons">
                    <button class="icon-btn" onclick="App.openCalendarModal()">üìÖ</button>
                    <button class="icon-btn" onclick="App.logout()">üö™</button>
                </div>
            </div>

            <div id="tours-list" class="clean-list"></div>
            
            <button class="fab-main admin-only" onclick="Data.prepareCreateTour()">+</button>
        </div>

        <div id="screen-staff" class="screen">
            <div class="ios-header">
                <h2>–ö–æ–º–∞–Ω–¥–∞</h2>
                <button class="btn-text admin-only" onclick="App.openEmployeeModal()">+</button>
            </div>
            <div id="staff-list" class="ios-list"></div>
        </div>

        <div id="screen-reports" class="screen">
            <div class="ios-header">
                <h2>–§–∏–Ω–∞–Ω—Å—ã</h2>
            </div>
            <div class="report-grid">
                <div class="report-card main">
                    <span class="rc-label">–ü—Ä–∏–±—ã–ª—å</span>
                    <span class="rc-val" id="rep-net">0 —Å</span>
                </div>
                <div class="report-card" onclick="UI.showReportDetail('guide')">
                    <span class="rc-label">–î–æ–ª–≥–∏ –ì–∏–¥–æ–≤</span>
                    <span class="rc-val warning" id="rep-cash-hands">0 —Å</span>
                </div>
                <div class="report-card" onclick="UI.showReportDetail('agent')">
                    <span class="rc-label">–ê–≥–µ–Ω—Ç—Å–∫–∏–µ</span>
                    <span class="rc-val" id="rep-agent">0 —Å</span>
                </div>
                <div class="report-card">
                    <span class="rc-label">–ö–∞—Å—Å–∞</span>
                    <span class="rc-val success" id="rep-cash-safe">0 —Å</span>
                </div>
            </div>
        </div>

        <div id="screen-add-tour" class="screen">
            <div class="ios-header">
                <button class="btn-back" onclick="Router.go('screen-tours')">–û—Ç–º–µ–Ω–∞</button>
                <h3 id="tour-form-title">–ù–æ–≤—ã–π</h3>
                <button class="btn-text" onclick="Data.saveTour()">–ì–æ—Ç–æ–≤–æ</button>
            </div>
            
            <div class="ios-form-group">
                <div class="row-between">
                    <label>–ú–ê–†–®–†–£–¢</label>
                    <button class="btn-link-sm" onclick="App.openDestModal()">‚öôÔ∏è –°–ø–∏—Å.</button>
                </div>
                <div id="destinations-container"></div>
                <button class="btn-link" onclick="Data.addDestInput()">+ –¢–æ—á–∫–∞</button>
            </div>
            
            <div class="ios-form-group">
                <label>–ö–û–ì–î–ê</label>
                <input type="datetime-local" id="new-tour-date">
                <div class="row-between" style="margin-top:10px;">
                    <span>–ü–æ–≤—Ç–æ—Ä—è—Ç—å (30 –¥–Ω–µ–π)</span>
                    <label class="switch"><input type="checkbox" id="is-recurring" onchange="App.toggleRecurring()"><span class="slider round"></span></label>
                </div>
                <div id="recurring-days" style="display:none; margin-top:10px;">
                    <div class="week-selector">
                        <div class="day-check" data-day="1" onclick="this.classList.toggle('selected')">–ü–Ω</div>
                        <div class="day-check" data-day="2" onclick="this.classList.toggle('selected')">–í—Ç</div>
                        <div class="day-check" data-day="3" onclick="this.classList.toggle('selected')">–°—Ä</div>
                        <div class="day-check" data-day="4" onclick="this.classList.toggle('selected')">–ß—Ç</div>
                        <div class="day-check" data-day="5" onclick="this.classList.toggle('selected')">–ü—Ç</div>
                        <div class="day-check" data-day="6" onclick="this.classList.toggle('selected')">–°–±</div>
                        <div class="day-check" data-day="0" onclick="this.classList.toggle('selected')">–í—Å</div>
                    </div>
                </div>
            </div>

            <div class="ios-form-group">
                <label>–î–ï–¢–ê–õ–ò</label>
                <input type="number" id="new-tour-price" placeholder="–¶–µ–Ω–∞ –±–∏–ª–µ—Ç–∞">
                <div class="row-inputs">
                    <select id="new-tour-driver"></select>
                    <input type="number" id="fee-driver" placeholder="–ó–ü">
                </div>
                <div class="row-inputs">
                    <select id="new-tour-guide"></select>
                    <input type="number" id="fee-guide" placeholder="–ó–ü">
                </div>
                <input type="number" id="fee-other" placeholder="–†–∞—Å—Ö–æ–¥—ã">
            </div>
        </div>

        <div id="screen-details" class="screen">
            <div class="ios-header">
                <button class="btn-back" onclick="Router.go('screen-tours')">–ù–∞–∑–∞–¥</button>
                <h3>–†–µ–π—Å</h3>
                <button class="btn-text admin-only" onclick="Data.editCurrentTour()">–ò–∑–º.</button>
            </div>
            
            <div class="tour-summary-card">
                <div class="row-between">
                    <h2 id="detail-title">–ù–∞–∑–≤–∞–Ω–∏–µ</h2>
                    <button class="btn-icon-small" onclick="App.openStoryModal()">üì∏</button>
                </div>
                <div id="hot-tour-control" style="display:none; margin-top:5px;">
                    <span class="badge-hot">–ì–û–†–Ø–©–ò–ô</span>
                </div>
                <div class="roi-bar-bg admin-only"><div id="detail-progress" class="roi-bar-fill"></div></div>
                <div class="roi-text admin-only"><span id="detail-income">0</span> / <span id="detail-expense">0</span></div>
            </div>

            <div class="seats-wrapper"><div class="bus-grid-sm" id="detail-grid"></div></div>

            <div class="passenger-section">
                <h4>–ü–∞—Å—Å–∞–∂–∏—Ä—ã</h4>
                <div id="passenger-list-container"></div>
                <div class="row-between" style="margin-top:20px;">
                    <button class="btn-outline" style="width:48%" onclick="App.generateManifest()">–°–ø–∏—Å–æ–∫</button>
                    <button class="btn-primary" style="width:48%; margin:0;" onclick="App.openWaModal()">WhatsApp</button>
                </div>
            </div>
        </div>

        <div id="modal-calendar" class="modal bottom-sheet">
            <div class="modal-content">
                <div class="cal-header">
                    <button class="cal-nav-btn" onclick="UI.changeMonth(-1)">‚Äπ</button>
                    <span id="cal-month-year">–ú–∞–π</span>
                    <button class="cal-nav-btn" onclick="UI.changeMonth(1)">‚Ä∫</button>
                </div>
                <div class="cal-weekdays"><span>–ü–ù</span><span>–í–¢</span><span>–°–†</span><span>–ß–¢</span><span>–ü–¢</span><span>–°–ë</span><span>–í–°</span></div>
                <div class="calendar-widget" id="calendar-widget"></div>
                <button class="btn btn-link" onclick="document.getElementById('modal-calendar').classList.remove('open')">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>

        <div id="modal-booking" class="modal">
            <div class="modal-content">
                <h3 id="modal-book-title">–ë—Ä–æ–Ω—å</h3>
                <input type="tel" id="book-phone" class="ios-input" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω" onblur="App.checkClient()">
                <div id="client-badge" class="badge-hidden"></div>
                <input type="text" id="book-name" class="ios-input" placeholder="–ò–º—è">
                
                <div class="row-between" style="background:white; padding:10px; border-radius:10px; margin:10px 0;">
                    <span>–û–ø–ª–∞—á–µ–Ω–æ</span>
                    <label class="switch"><input type="checkbox" id="book-paid-switch"><span class="slider round"></span></label>
                </div>

                <div class="counter-row" id="seat-counter-block">
                    <span>–ú–µ—Å—Ç:</span>
                    <button onclick="App.changeSeatCount(-1)">-</button><span id="book-count">1</span><button onclick="App.changeSeatCount(1)">+</button>
                </div>

                <button class="btn btn-primary" onclick="Data.saveBooking()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button class="btn btn-danger" id="btn-cancel-booking" onclick="Data.cancelBooking()">–£–¥–∞–ª–∏—Ç—å</button>
                <button class="btn btn-link" onclick="App.closeBookingModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>

        <div id="modal-day-details" class="modal bottom-sheet">
            <div class="modal-content">
                <h3 id="day-modal-title">–î–∞—Ç–∞</h3>
                <div id="day-tours-list" class="ios-list-simple"></div>
                <button class="btn btn-primary admin-only" id="btn-create-on-date">–°–æ–∑–¥–∞—Ç—å —Ç—É—Ä</button>
                <button class="btn btn-link" onclick="document.getElementById('modal-day-details').classList.remove('open')">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>

        <div id="modal-destinations" class="modal"><div class="modal-content"><h3>–õ–æ–∫–∞—Ü–∏–∏</h3><div class="row-inputs"><input type="text" id="new-dest-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ"><button class="btn-primary" style="width:auto;margin:0" onclick="Data.addDestinationToDb()">+</button></div><div id="dest-list-db" class="ios-list-simple"></div><button class="btn btn-link" onclick="document.getElementById('modal-destinations').classList.remove('open')">–ó–∞–∫—Ä—ã—Ç—å</button></div></div>
        <div id="modal-whatsapp" class="modal bottom-sheet"><div class="modal-content"><h3>WhatsApp</h3><div class="segment-control"><button class="seg-btn active" onclick="App.setWaTemplate('info')">–ò–Ω—Ñ–æ</button><button class="seg-btn" onclick="App.setWaTemplate('review')">–û—Ç–∑—ã–≤</button></div><textarea id="wa-text-area" rows="5" class="ios-input"></textarea><button class="btn btn-primary" onclick="App.copyWaText()">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button><button class="btn btn-link" onclick="document.getElementById('modal-whatsapp').classList.remove('open')">–ó–∞–∫—Ä—ã—Ç—å</button></div></div>
        <div id="modal-story" class="modal"><div class="modal-content" style="background:#222;color:white;text-align:center"><div class="story-card"><div class="story-date" id="story-date">–ó–ê–í–¢–†–ê</div><h2 id="story-title">–¢—É—Ä</h2><div class="story-price" id="story-price">0c</div><div class="story-seats" id="story-seats">–ú–µ—Å—Ç–∞ –µ—Å—Ç—å!</div></div><button class="btn btn-link" style="color:white" onclick="document.getElementById('modal-story').classList.remove('open')">–ó–∞–∫—Ä—ã—Ç—å</button></div></div>
        <div id="modal-report-detail" class="modal"><div class="modal-content"><h3 id="report-detail-title">–î–µ—Ç–∞–ª–∏</h3><div id="report-detail-list" class="ios-list-simple"></div><button class="btn btn-link" onclick="document.getElementById('modal-report-detail').classList.remove('open')">–ó–∞–∫—Ä—ã—Ç—å</button></div></div>
        <div id="modal-deposit" class="modal"><div class="modal-content"><h3>–°–¥–∞—á–∞</h3><p id="deposit-guide-name">–ì–∏–¥</p><input type="number" id="deposit-amount" class="ios-input" placeholder="–°—É–º–º–∞"><button class="btn btn-primary" onclick="Data.makeDeposit()">–ü—Ä–∏–Ω—è—Ç—å</button><button class="btn btn-link" onclick="document.getElementById('modal-deposit').classList.remove('open')">–û—Ç–º–µ–Ω–∞</button></div></div>
        <div id="modal-employee" class="modal"><div class="modal-content"><h3 id="emp-modal-title">–°–æ—Ç—Ä—É–¥–Ω–∏–∫</h3><input type="text" id="emp-name" class="ios-input" placeholder="–ò–º—è"><input type="tel" id="emp-phone" class="ios-input" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω"><select id="emp-role" class="ios-input" onchange="App.toggleCapacityField()"><option value="driver">–í–æ–¥–∏—Ç–µ–ª—å</option><option value="guide">–ì–∏–¥</option><option value="agent">–ê–≥–µ–Ω—Ç</option></select><div id="emp-extra-fields"><input type="number" id="emp-capacity" class="ios-input" placeholder="–ú–µ—Å—Ç (18)" value="18"><input type="number" id="emp-commission" class="ios-input" placeholder="%" style="display:none"></div><button class="btn btn-primary" onclick="Data.saveEmployee()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button><button class="btn btn-link" onclick="App.closeEmployeeModal()">–ó–∞–∫—Ä—ã—Ç—å</button></div></div>

        <div id="bottom-nav" class="bottom-nav" style="display: none;">
            <div class="nav-item active" onclick="Router.go('screen-tours')"><div class="nav-icon">üìÖ</div><span>–¢—É—Ä—ã</span></div>
            <div class="nav-item admin-only" onclick="Router.go('screen-reports')"><div class="nav-icon">üìä</div><span>–û—Ç—á–µ—Ç—ã</span></div>
            <div class="nav-item admin-only" onclick="Router.go('screen-staff')"><div class="nav-icon">üë•</div><span>–ö–æ–º–∞–Ω–¥–∞</span></div>
        </div>

    </div>
    <script src="app.js"></script>
</body>
</html>
